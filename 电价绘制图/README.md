# 电价趋势分析图生成工具 📊

这是一个用于生成**专业级电价趋势分析图表**的Python工具，提供丰富的统计信息和美观的数据可视化。

## ✨ 功能特性

### 核心功能
- 🎯 **关键指标信息卡**：顶部展示日前均价、实时均价、平均价差和相关系数等核心指标
- 📈 **趋势线可视化**：绘制日前均价与实时均价的趋势线，带标记和数据标签
- 🎪 **关键点高亮**：自动标注最高点和最低点，快速识别价格极值
- 📊 **价差分析图**：独立的价差柱状图，绿色表示正溢价，红色表示负溢价
- 📉 **统计置信区间**：展示均值线和±1σ标准差范围
- 💡 **智能洞察面板**：底部提供详细统计摘要和关键市场洞察

### 视觉美化
- 🎨 **专业配色方案**：采用协调的Tailwind配色，视觉舒适
- 🖼️ **信息卡设计**：顶部使用圆角卡片展示关键指标，层次分明
- 🌈 **渐变背景**：不同区域使用浅色背景区分，主图、价差图各具特色
- 🔍 **高分辨率**：支持300 DPI输出，适合印刷和展示

### 统计信息
- 📌 **波动率分析**：计算日前和实时价格的波动率（CV）
- 🔗 **相关性分析**：展示日前与实时价格的相关系数
- 💰 **溢价率计算**：平均实时溢价率百分比
- 📊 **完整统计表**：包含均值、标准差、最大值、最小值
- 💬 **智能洞察**：自动生成关键事件描述（峰值、极值价差等）

## 📁 文件说明

- `电价趋势图绘制.py` - 主程序脚本
- `每日电价分享.xlsx` - 输入数据文件（Excel格式）
- `电价趋势分析图_专业版.png` - 输出的高清图表文件
- `README.md` - 本文档

## 🚀 使用方法

### 安装依赖

```bash
pip install pandas matplotlib numpy seaborn openpyxl
```

> 📦 仓库已自带中文字体 `WenQuanYiMicroHei.ttf`，脚本会自动加载，确保中文标题和标注不会显示为方块。

**可选依赖**（用于优化数据标签布局，避免重叠）：
```bash
pip install adjustText
```

### 运行脚本

#### 方式一：使用Excel数据（正式使用）

```bash
cd 电价绘制图
python 电价趋势图绘制.py
```

脚本会自动：
1. 读取同目录下的 `每日电价分享.xlsx` 文件
2. 处理数据并计算各项统计指标
3. 生成美观的可视化图表
4. 保存为高清PNG文件：`电价趋势分析图_专业版.png`
5. 在屏幕上显示图表（可选）

如果找不到Excel文件，脚本会使用内置的演示数据生成示例图表。

#### 方式二：快速预览（推荐新手）

```bash
cd 电价绘制图
python 快速预览.py
```

使用内置演示数据快速生成示例图表，无需准备Excel文件。生成的图表会保存为 `电价趋势分析图_快速预览.png`，并在控制台显示详细的功能说明。

## 📋 数据格式要求

Excel文件应包含**三列**数据：

| 列名 | 数据类型 | 示例 |
|------|---------|------|
| 日期 | 日期格式 | 2025/6/29 |
| 日前均价 | 数值型 | 306.28 |
| 实时均价 | 数值型 | 550.50 |

**注意事项**：
- 日期格式支持多种常见格式（如 `2025/6/29`、`2025-06-29` 等）
- 包含缺失值的行会被自动过滤
- 数据会按日期自动排序

## 📊 输出说明

生成的图表包含**四个部分**：

### 1. 顶部关键指标卡 🎯
展示四个核心指标卡片：
- **日前均价** - 平均值及波动率
- **实时均价** - 平均值及波动率  
- **平均价差** - 实时与日前的差值及标准差
- **相关系数** - 两种价格的关联性及平均溢价率

### 2. 主趋势图 📈
- 日前均价和实时均价的走势曲线
- 两条价格均值参考线（虚线）
- 价格标准差置信区间（浅色填充区域）
- 价差区间填充（两条曲线之间）
- 自动标注最高点和最低点（白色圆圈突出显示）
- 可选的数据标签（每隔几个点显示具体数值）

### 3. 价差分析图 📊
- 柱状图展示每日价差（实时均价 - 日前均价）
- 绿色柱：正溢价（实时 > 日前）
- 橙红色柱：负溢价（实时 < 日前）
- 平均价差参考线（虚线）
- 标注最大正溢价和最大负溢价

### 4. 统计信息与洞察面板 📋
左侧：
- 核心统计摘要表格
- 包含日前均价、实时均价、价差的均值、标准差、最小值、最大值

右侧：
- 智能生成的关键洞察点
- 包括峰值出现日期、极值价差事件、相关性分析等

## 🎨 设计亮点

1. **四层式布局**：信息密度高但不拥挤，层次清晰
2. **配色协调**：使用专业的配色方案，蓝色系代表日前，红色系代表实时
3. **视觉焦点**：关键点用白色空心圆突出，吸引注意力
4. **信息卡设计**：顶部指标卡采用圆角卡片设计，现代简洁
5. **背景区分**：不同区域使用微妙的背景色区分（浅蓝、浅黄等）
6. **智能标注**：自动避免标签重叠（需要adjustText库）

## 🔧 自定义选项

可以通过修改函数参数来自定义图表：

```python
fig, axes = plot_daily_price_trend(
    df,
    save_path='custom_output.png',  # 自定义输出路径
    show_labels=False,               # 是否显示数据标签
    figsize=(24, 18)                 # 图表尺寸（英寸）
)
```

## 💡 使用建议

- 对于数据量较大的情况（超过50天），建议关闭数据标签以保持图表整洁
- 安装 `adjustText` 库可以让数据标签自动避免重叠，显著提升可读性
- 输出图片适合用于报告、演示文稿和打印（300 DPI）
- 可以直接在Jupyter Notebook中使用该函数进行交互式分析

## 📝 更新日志

### v2.0 - 2025年（当前版本）
- ✨ 新增顶部关键指标信息卡
- 🎨 全面重构视觉设计，采用现代化配色方案
- 📊 新增波动率、溢价率等高级统计指标
- 💡 新增智能洞察面板，自动生成分析要点
- 🎯 改进关键点标注，使用空心圆突出显示
- 🖼️ 优化布局，采用四层式设计
- 📈 增强价差图，标注最大正负溢价

### v1.0 - 初始版本
- 基础趋势线绘制
- 简单统计信息展示
- 价差分析柱状图

## 🤝 贡献

欢迎提出建议和改进意见！

## 📄 许可

MIT License
